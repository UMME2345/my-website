<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizManager - Invoice & Inventory Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #0F172A;
            --secondary: #64748B;
            --light-bg: #F1F5F9;
            --white: #FFFFFF;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--primary);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--secondary);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--primary);
        }

        h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--secondary);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: var(--primary);
            background-color: rgba(15, 23, 42, 0.05);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--secondary);
            border-radius: var(--radius);
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn:hover {
            background-color: #1E293B;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #475569;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-warning:hover {
            background-color: #D97706;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #DC2626;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }

        .logo-upload {
            border: 2px dashed var(--secondary);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .logo-upload:hover {
            border-color: var(--primary);
            background-color: rgba(15, 23, 42, 0.05);
        }

        .logo-preview {
            max-width: 150px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
        }

        .invoice-preview {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-top: 30px;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .invoice-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .invoice-logo {
            max-width: 150px;
            max-height: 100px;
        }

        .invoice-meta {
            text-align: right;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .invoice-table th {
            background-color: var(--light-bg);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
        }

        .invoice-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light-bg);
        }

        .invoice-table tr:last-child td {
            border-bottom: none;
        }

        .invoice-totals {
            margin-top: 20px;
            text-align: right;
        }

        .invoice-totals table {
            display: inline-block;
        }

        .invoice-totals td {
            padding: 8px 15px;
        }

        .invoice-totals tr:last-child td {
            font-weight: 700;
            font-size: 18px;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-bg);
        }

        th {
            background-color: var(--light-bg);
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(241, 245, 249, 0.5);
        }

        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.pending {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .status.paid {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .status.overdue {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .status.low-stock {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .status.in-stock {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .status.out-of-stock {
            background-color: #FEE2E2;
            color: #991B1B;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 16px;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .invoice-header {
                flex-direction: column;
            }

            .invoice-meta {
                text-align: left;
                margin-top: 20px;
            }

            .item-row {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                justify-content: flex-start;
            }
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>BizManager</h1>
            <div>
                <button id="toggleTheme" class="btn btn-secondary">
                    <i class="fas fa-moon"></i> Dark Mode
                </button>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="invoice">Invoice Generator</div>
            <div class="tab" data-tab="inventory">Inventory Management</div>
            <div class="tab" data-tab="payables">Payables</div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="stats-cards">
                <div class="stat-card fade-in">
                    <h3>Total Stock Value</h3>
                    <p id="totalStockValue">$0.00</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>Total Payables</h3>
                    <p id="totalPayables">$0.00</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>Low Stock Items</h3>
                    <p id="lowStockCount">0</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>Recent Invoices</h3>
                    <p id="recentInvoices">0</p>
                </div>
            </div>

            <div class="card">
                <h2>Recent Activity</h2>
                <div id="recentActivity">
                    <p>No recent activity</p>
                </div>
            </div>
        </div>

        <!-- Invoice Generator Tab -->
        <div class="tab-content" id="invoice">
            <div class="card">
                <h2>Invoice Generator</h2>
                
                <div class="grid">
                    <div>
                        <h3>Your Business Details</h3>
                        <div class="form-group">
                            <label for="businessName">Business Name</label>
                            <input type="text" id="businessName" placeholder="Your Business Name">
                        </div>
                        <div class="form-group">
                            <label for="businessAddress">Address</label>
                            <textarea id="businessAddress" rows="3" placeholder="Street, City, State, ZIP"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="businessEmail">Email</label>
                            <input type="email" id="businessEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label for="businessPhone">Phone</label>
                            <input type="tel" id="businessPhone" placeholder="+1 (123) 456-7890">
                        </div>
                        <div class="form-group">
                            <label>Business Logo</label>
                            <div class="logo-upload" id="logoUploadArea">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 24px; margin-bottom: 10px;"></i>
                                <p>Drag & drop your logo here or click to browse</p>
                                <img id="logoPreview" class="logo-preview" alt="Logo Preview">
                            </div>
                            <input type="file" id="logoInput" accept="image/png" style="display: none;">
                        </div>
                    </div>

                    <div>
                        <h3>Client Details</h3>
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" id="clientName" placeholder="Client's Name">
                        </div>
                        <div class="form-group">
                            <label for="clientCompany">Company</label>
                            <input type="text" id="clientCompany" placeholder="Client's Company (if applicable)">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">Email</label>
                            <input type="email" id="clientEmail" placeholder="client@email.com">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Phone</label>
                            <input type="tel" id="clientPhone" placeholder="+1 (123) 456-7890">
                        </div>
                        <div class="form-group">
                            <label for="clientAddress">Address</label>
                            <textarea id="clientAddress" rows="3" placeholder="Street, City, State, ZIP"></textarea>
                        </div>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Invoice Items</h3>
                <div id="invoiceItems">
                    <div class="item-row">
                        <input type="text" class="item-desc" placeholder="Description">
                        <input type="number" class="item-qty" placeholder="Qty" min="1" value="1">
                        <input type="number" class="item-price" placeholder="Unit Price" min="0" step="0.01">
                        <span class="item-subtotal">$0.00</span>
                        <div class="action-buttons">
                            <button class="btn btn-danger btn-sm remove-item"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>
                <button id="addItem" class="btn btn-secondary"><i class="fas fa-plus"></i> Add Item</button>

                <div class="form-group" style="margin-top: 20px;">
                    <label for="invoiceNotes">Notes</label>
                    <textarea id="invoiceNotes" rows="3" placeholder="Thank you for your business!"></textarea>
                </div>

                <div class="form-group">
                    <label for="invoiceTax">Tax Rate (%)</label>
                    <input type="number" id="invoiceTax" value="10" min="0" max="100" step="0.1">
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="previewInvoice" class="btn"><i class="fas fa-eye"></i> Preview Invoice</button>
                    <button id="saveInvoiceData" class="btn btn-secondary"><i class="fas fa-save"></i> Save Data</button>
                    <button id="clearInvoice" class="btn btn-danger"><i class="fas fa-trash"></i> Clear All</button>
                </div>
            </div>

            <div class="invoice-preview" id="invoicePreviewContainer" style="display: none;">
                <div class="invoice-header">
                    <div>
                        <img id="previewLogo" class="invoice-logo" alt="Business Logo" style="max-width: 150px; margin-bottom: 20px;">
                        <h2 id="previewBusinessName">Your Business Name</h2>
                        <p id="previewBusinessAddress">123 Business St, City, State ZIP</p>
                        <p id="previewBusinessEmail">your@email.com</p>
                        <p id="previewBusinessPhone">+1 (123) 456-7890</p>
                    </div>
                    <div class="invoice-meta">
                        <h2>INVOICE</h2>
                        <p><strong>Invoice #:</strong> <span id="invoiceNumber">INV-001</span></p>
                        <p><strong>Date:</strong> <span id="invoiceDate">May 30, 2023</span></p>
                        <p><strong>Due Date:</strong> <span id="invoiceDueDate">June 6, 2023</span></p>
                    </div>
                </div>

                <div style="margin: 30px 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <h3>Bill To:</h3>
                            <p id="previewClientName">Client Name</p>
                            <p id="previewClientCompany">Client Company</p>
                            <p id="previewClientAddress">123 Client St, City, State ZIP</p>
                            <p id="previewClientEmail">client@email.com</p>
                            <p id="previewClientPhone">+1 (123) 456-7890</p>
                        </div>
                    </div>
                </div>

                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="previewItems">
                        <!-- Items will be added here -->
                    </tbody>
                </table>

                <div class="invoice-totals">
                    <table>
                        <tr>
                            <td>Subtotal:</td>
                            <td id="previewSubtotal">$0.00</td>
                        </tr>
                        <tr>
                            <td>Tax (<span id="previewTaxRate">10</span>%):</td>
                            <td id="previewTaxAmount">$0.00</td>
                        </tr>
                        <tr>
                            <td>Total:</td>
                            <td id="previewTotal">$0.00</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-top: 40px;">
                    <p id="previewNotes">Thank you for your business!</p>
                </div>

                <div style="text-align: center; margin-top: 50px;">
                    <button id="downloadPdf" class="btn btn-success"><i class="fas fa-file-pdf"></i> Download PDF</button>
                </div>
            </div>
        </div>

        <!-- Inventory Management Tab -->
        <div class="tab-content" id="inventory">
            <div class="card">
                <h2>Inventory Management</h2>
                
                <div class="search-box">
                    <input type="text" id="inventorySearch" placeholder="Search products...">
                </div>

                <div class="table-responsive">
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Value</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryItems">
                            <!-- Inventory items will be added here -->
                        </tbody>
                    </table>
                </div>

                <button id="addInventoryItem" class="btn"><i class="fas fa-plus"></i> Add Product</button>
                <button id="exportInventory" class="btn btn-secondary"><i class="fas fa-file-csv"></i> Export as CSV</button>
            </div>

            <div class="card" id="inventoryFormContainer" style="display: none;">
                <h3 id="inventoryFormTitle">Add New Product</h3>
                <div class="grid">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" placeholder="Product Name">
                    </div>
                    <div class="form-group">
                        <label for="productSku">SKU</label>
                        <input type="text" id="productSku" placeholder="SKU">
                    </div>
                    <div class="form-group">
                        <label for="productQuantity">Quantity</label>
                        <input type="number" id="productQuantity" placeholder="Quantity" min="0">
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Unit Price ($)</label>
                        <input type="number" id="productPrice" placeholder="Price" min="0" step="0.01">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="saveInventoryItem" class="btn btn-success"><i class="fas fa-save"></i> Save</button>
                    <button id="cancelInventoryItem" class="btn btn-danger"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </div>
        </div>

        <!-- Payables Tab -->
        <div class="tab-content" id="payables">
            <div class="card">
                <h2>Payables Management</h2>
                
                <div class="search-box">
                    <input type="text" id="payablesSearch" placeholder="Search payables...">
                </div>

                <div class="table-responsive">
                    <table id="payablesTable">
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="payablesItems">
                            <!-- Payables items will be added here -->
                        </tbody>
                    </table>
                </div>

                <button id="addPayable" class="btn"><i class="fas fa-plus"></i> Add Payable</button>
            </div>

            <div class="card" id="payableFormContainer" style="display: none;">
                <h3 id="payableFormTitle">Add New Payable</h3>
                <div class="grid">
                    <div class="form-group">
                        <label for="payableVendor">Vendor</label>
                        <input type="text" id="payableVendor" placeholder="Vendor Name">
                    </div>
                    <div class="form-group">
                        <label for="payableDescription">Description</label>
                        <input type="text" id="payableDescription" placeholder="Description">
                    </div>
                    <div class="form-group">
                        <label for="payableAmount">Amount ($)</label>
                        <input type="number" id="payableAmount" placeholder="Amount" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="payableDueDate">Due Date</label>
                        <input type="date" id="payableDueDate">
                    </div>
                    <div class="form-group">
                        <label for="payableStatus">Status</label>
                        <select id="payableStatus">
                            <option value="pending">Pending</option>
                            <option value="paid">Paid</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="savePayable" class="btn btn-success"><i class="fas fa-save"></i> Save</button>
                    <button id="cancelPayable" class="btn btn-danger"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentInventoryItemId = null;
        let currentPayableId = null;
        let inventory = [];
        let payables = [];
        let invoiceData = {};
        let darkMode = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update dashboard stats when switching to dashboard
                    if (tabId === 'dashboard') {
                        updateDashboardStats();
                    }
                });
            });

            // Load saved data from localStorage
            loadSavedData();

            // Initialize invoice generator
            initInvoiceGenerator();

            // Initialize inventory management
            initInventoryManagement();

            // Initialize payables management
            initPayablesManagement();

            // Theme toggle
            document.getElementById('toggleTheme').addEventListener('click', toggleTheme);

            // Generate a random invoice number
            generateInvoiceNumber();
        });

        // Load saved data from localStorage
        function loadSavedData() {
            // Load inventory
            const savedInventory = localStorage.getItem('inventory');
            if (savedInventory) {
                inventory = JSON.parse(savedInventory);
                renderInventoryTable();
            }

            // Load payables
            const savedPayables = localStorage.getItem('payables');
            if (savedPayables) {
                payables = JSON.parse(savedPayables);
                renderPayablesTable();
            }

            // Load invoice data
            const savedInvoiceData = localStorage.getItem('invoiceData');
            if (savedInvoiceData) {
                invoiceData = JSON.parse(savedInvoiceData);
                loadInvoiceData();
            }

            // Load theme preference
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                darkMode = true;
                applyDarkMode();
            }
        }

        // Initialize invoice generator
        function initInvoiceGenerator() {
            // Add item button
            document.getElementById('addItem').addEventListener('click', addInvoiceItemRow);

            // Remove item buttons (delegated event)
            document.getElementById('invoiceItems').addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-item') || e.target.closest('.remove-item')) {
                    const itemRow = e.target.closest('.item-row');
                    if (document.querySelectorAll('.item-row').length > 1) {
                        itemRow.remove();
                        calculateInvoiceTotals();
                    } else {
                        // Clear the single remaining row instead of removing it
                        itemRow.querySelector('.item-desc').value = '';
                        itemRow.querySelector('.item-qty').value = '1';
                        itemRow.querySelector('.item-price').value = '';
                        itemRow.querySelector('.item-subtotal').textContent = '$0.00';
                        calculateInvoiceTotals();
                    }
                }
            });

            // Input changes for calculations
            document.getElementById('invoiceItems').addEventListener('input', function(e) {
                if (e.target.classList.contains('item-qty') || e.target.classList.contains('item-price')) {
                    const row = e.target.closest('.item-row');
                    calculateRowTotal(row);
                    calculateInvoiceTotals();
                }
            });

            // Logo upload
            const logoUploadArea = document.getElementById('logoUploadArea');
            const logoInput = document.getElementById('logoInput');

            logoUploadArea.addEventListener('click', () => logoInput.click());
            logoUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                logoUploadArea.style.borderColor = '#0F172A';
                logoUploadArea.style.backgroundColor = 'rgba(15, 23, 42, 0.05)';
            });
            logoUploadArea.addEventListener('dragleave', () => {
                logoUploadArea.style.borderColor = '#64748B';
                logoUploadArea.style.backgroundColor = 'transparent';
            });
            logoUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                logoUploadArea.style.borderColor = '#64748B';
                logoUploadArea.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length) {
                    logoInput.files = e.dataTransfer.files;
                    handleLogoUpload();
                }
            });

            logoInput.addEventListener('change', handleLogoUpload);

            // Preview invoice
            document.getElementById('previewInvoice').addEventListener('click', previewInvoice);

            // Download PDF
            document.getElementById('downloadPdf').addEventListener('click', downloadPdf);

            // Save invoice data
            document.getElementById('saveInvoiceData').addEventListener('click', saveInvoiceData);

            // Clear invoice
            document.getElementById('clearInvoice').addEventListener('click', clearInvoice);
        }

        // Initialize inventory management
        function initInventoryManagement() {
            // Add inventory item button
            document.getElementById('addInventoryItem').addEventListener('click', showInventoryForm);

            // Save inventory item
            document.getElementById('saveInventoryItem').addEventListener('click', saveInventoryItem);

            // Cancel inventory item
            document.getElementById('cancelInventoryItem').addEventListener('click', hideInventoryForm);

            // Search inventory
            document.getElementById('inventorySearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#inventoryItems tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });

            // Export inventory
            document.getElementById('exportInventory').addEventListener('click', exportInventoryToCSV);

            // Edit/Delete buttons (delegated events)
            document.getElementById('inventoryItems').addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-item') || e.target.closest('.edit-item')) {
                    const id = e.target.closest('tr').getAttribute('data-id');
                    editInventoryItem(id);
                }
                
                if (e.target.classList.contains('delete-item') || e.target.closest('.delete-item')) {
                    const id = e.target.closest('tr').getAttribute('data-id');
                    deleteInventoryItem(id);
                }
            });
        }

        // Initialize payables management
        function initPayablesManagement() {
            // Add payable button
            document.getElementById('addPayable').addEventListener('click', showPayableForm);

            // Save payable
            document.getElementById('savePayable').addEventListener('click', savePayable);

            // Cancel payable
            document.getElementById('cancelPayable').addEventListener('click', hidePayableForm);

            // Search payables
            document.getElementById('payablesSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#payablesItems tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });

            // Edit/Delete buttons (delegated events)
            document.getElementById('payablesItems').addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-payable') || e.target.closest('.edit-payable')) {
                    const id = e.target.closest('tr').getAttribute('data-id');
                    editPayable(id);
                }
                
                if (e.target.classList.contains('delete-payable') || e.target.closest('.delete-payable')) {
                    const id = e.target.closest('tr').getAttribute('data-id');
                    deletePayable(id);
                }
            });
        }

        // Invoice Generator Functions
        function addInvoiceItemRow() {
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row fade-in';
            itemRow.innerHTML = `
                <input type="text" class="item-desc" placeholder="Description">
                <input type="number" class="item-qty" placeholder="Qty" min="1" value="1">
                <input type="number" class="item-price" placeholder="Unit Price" min="0" step="0.01">
                <span class="item-subtotal">$0.00</span>
                <div class="action-buttons">
                    <button class="btn btn-danger btn-sm remove-item"><i class="fas fa-trash"></i></button>
                </div>
            `;
            document.getElementById('invoiceItems').appendChild(itemRow);
        }

        function calculateRowTotal(row) {
            const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
            const price = parseFloat(row.querySelector('.item-price').value) || 0;
            const subtotal = qty * price;
            row.querySelector('.item-subtotal').textContent = formatCurrency(subtotal);
        }

        function calculateInvoiceTotals() {
            const rows = document.querySelectorAll('.item-row');
            let subtotal = 0;
            
            rows.forEach(row => {
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                subtotal += qty * price;
            });
            
            const taxRate = parseFloat(document.getElementById('invoiceTax').value) || 0;
            const taxAmount = subtotal * (taxRate / 100);
            const total = subtotal + taxAmount;
            
            document.getElementById('previewSubtotal').textContent = formatCurrency(subtotal);
            document.getElementById('previewTaxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('previewTotal').textContent = formatCurrency(total);
            document.getElementById('previewTaxRate').textContent = taxRate;
        }

        function previewInvoice() {
            // Business details
            document.getElementById('previewBusinessName').textContent = document.getElementById('businessName').value || 'Your Business Name';
            document.getElementById('previewBusinessAddress').textContent = document.getElementById('businessAddress').value || '123 Business St, City, State ZIP';
            document.getElementById('previewBusinessEmail').textContent = document.getElementById('businessEmail').value || 'your@email.com';
            document.getElementById('previewBusinessPhone').textContent = document.getElementById('businessPhone').value || '+1 (123) 456-7890';
            
            // Client details
            document.getElementById('previewClientName').textContent = document.getElementById('clientName').value || 'Client Name';
            document.getElementById('previewClientCompany').textContent = document.getElementById('clientCompany').value || 'Client Company';
            document.getElementById('previewClientAddress').textContent = document.getElementById('clientAddress').value || '123 Client St, City, State ZIP';
            document.getElementById('previewClientEmail').textContent = document.getElementById('clientEmail').value || 'client@email.com';
            document.getElementById('previewClientPhone').textContent = document.getElementById('clientPhone').value || '+1 (123) 456-7890';
            
            // Invoice notes
            document.getElementById('previewNotes').textContent = document.getElementById('invoiceNotes').value || 'Thank you for your business!';
            
            // Invoice items
            const previewItems = document.getElementById('previewItems');
            previewItems.innerHTML = '';
            
            const rows = document.querySelectorAll('.item-row');
            rows.forEach(row => {
                const desc = row.querySelector('.item-desc').value || 'Item Description';
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const subtotal = qty * price;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${desc}</td>
                    <td>${qty}</td>
                    <td>${formatCurrency(price)}</td>
                    <td>${formatCurrency(subtotal)}</td>
                `;
                previewItems.appendChild(tr);
            });
            
            // Calculate totals
            calculateInvoiceTotals();
            
            // Show preview
            document.getElementById('invoicePreviewContainer').style.display = 'block';
            
            // Scroll to preview
            document.getElementById('invoicePreviewContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadPdf() {
            const element = document.getElementById('invoicePreviewContainer');
            const opt = {
                margin: 10,
                filename: `invoice_${document.getElementById('invoiceNumber').textContent}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Use html2canvas and jsPDF to generate PDF
            html2canvas(element, {
                scale: 2,
                logging: false,
                useCORS: true
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(opt.filename);
                
                // Add to recent activity
                addActivity(`Generated PDF invoice ${document.getElementById('invoiceNumber').textContent}`);
                updateDashboardStats();
            });
        }

        function saveInvoiceData() {
            // Collect all invoice data
            invoiceData = {
                business: {
                    name: document.getElementById('businessName').value,
                    address: document.getElementById('businessAddress').value,
                    email: document.getElementById('businessEmail').value,
                    phone: document.getElementById('businessPhone').value,
                    logo: document.getElementById('logoPreview').src
                },
                client: {
                    name: document.getElementById('clientName').value,
                    company: document.getElementById('clientCompany').value,
                    email: document.getElementById('clientEmail').value,
                    phone: document.getElementById('clientPhone').value,
                    address: document.getElementById('clientAddress').value
                },
                items: [],
                notes: document.getElementById('invoiceNotes').value,
                taxRate: document.getElementById('invoiceTax').value
            };

            // Collect items
            const rows = document.querySelectorAll('.item-row');
            rows.forEach(row => {
                invoiceData.items.push({
                    description: row.querySelector('.item-desc').value,
                    quantity: row.querySelector('.item-qty').value,
                    unitPrice: row.querySelector('.item-price').value
                });
            });

            // Save to localStorage
            localStorage.setItem('invoiceData', JSON.stringify(invoiceData));
            
            // Show success message
            alert('Invoice data saved successfully!');
            
            // Add to recent activity
            addActivity('Saved invoice data');
            updateDashboardStats();
        }

        function loadInvoiceData() {
            if (!invoiceData) return;

            // Business details
            if (invoiceData.business) {
                document.getElementById('businessName').value = invoiceData.business.name || '';
                document.getElementById('businessAddress').value = invoiceData.business.address || '';
                document.getElementById('businessEmail').value = invoiceData.business.email || '';
                document.getElementById('businessPhone').value = invoiceData.business.phone || '';
                
                if (invoiceData.business.logo) {
                    document.getElementById('logoPreview').src = invoiceData.business.logo;
                    document.getElementById('logoPreview').style.display = 'block';
                }
            }

            // Client details
            if (invoiceData.client) {
                document.getElementById('clientName').value = invoiceData.client.name || '';
                document.getElementById('clientCompany').value = invoiceData.client.company || '';
                document.getElementById('clientEmail').value = invoiceData.client.email || '';
                document.getElementById('clientPhone').value = invoiceData.client.phone || '';
                document.getElementById('clientAddress').value = invoiceData.client.address || '';
            }

            // Items
            if (invoiceData.items && invoiceData.items.length > 0) {
                // Clear existing items (except the first one)
                const itemsContainer = document.getElementById('invoiceItems');
                while (itemsContainer.children.length > 1) {
                    itemsContainer.removeChild(itemsContainer.lastChild);
                }

                // Load items
                const firstRow = itemsContainer.querySelector('.item-row');
                if (invoiceData.items[0]) {
                    firstRow.querySelector('.item-desc').value = invoiceData.items[0].description || '';
                    firstRow.querySelector('.item-qty').value = invoiceData.items[0].quantity || '1';
                    firstRow.querySelector('.item-price').value = invoiceData.items[0].unitPrice || '';
                    calculateRowTotal(firstRow);
                }

                // Add additional items
                for (let i = 1; i < invoiceData.items.length; i++) {
                    addInvoiceItemRow();
                    const newRow = itemsContainer.children[itemsContainer.children.length - 1];
                    newRow.querySelector('.item-desc').value = invoiceData.items[i].description || '';
                    newRow.querySelector('.item-qty').value = invoiceData.items[i].quantity || '1';
                    newRow.querySelector('.item-price').value = invoiceData.items[i].unitPrice || '';
                    calculateRowTotal(newRow);
                }
            }

            // Notes and tax
            if (invoiceData.notes) {
                document.getElementById('invoiceNotes').value = invoiceData.notes;
            }
            if (invoiceData.taxRate) {
                document.getElementById('invoiceTax').value = invoiceData.taxRate;
            }

            // Calculate totals
            calculateInvoiceTotals();
        }

        function clearInvoice() {
            if (confirm('Are you sure you want to clear all invoice data?')) {
                // Clear form fields
                document.getElementById('businessName').value = '';
                document.getElementById('businessAddress').value = '';
                document.getElementById('businessEmail').value = '';
                document.getElementById('businessPhone').value = '';
                document.getElementById('logoPreview').src = '';
                document.getElementById('logoPreview').style.display = 'none';
                
                document.getElementById('clientName').value = '';
                document.getElementById('clientCompany').value = '';
                document.getElementById('clientEmail').value = '';
                document.getElementById('clientPhone').value = '';
                document.getElementById('clientAddress').value = '';
                
                document.getElementById('invoiceNotes').value = 'Thank you for your business!';
                document.getElementById('invoiceTax').value = '10';
                
                // Clear items (leave one empty row)
                const itemsContainer = document.getElementById('invoiceItems');
                while (itemsContainer.children.length > 1) {
                    itemsContainer.removeChild(itemsContainer.lastChild);
                }
                
                const firstRow = itemsContainer.querySelector('.item-row');
                firstRow.querySelector('.item-desc').value = '';
                firstRow.querySelector('.item-qty').value = '1';
                firstRow.querySelector('.item-price').value = '';
                firstRow.querySelector('.item-subtotal').textContent = '$0.00';
                
                // Clear preview
                document.getElementById('invoicePreviewContainer').style.display = 'none';
                
                // Clear saved data
                invoiceData = {};
                localStorage.removeItem('invoiceData');
                
                // Generate new invoice number
                generateInvoiceNumber();
                
                // Add to recent activity
                addActivity('Cleared invoice data');
            }
        }

        function handleLogoUpload() {
            const file = document.getElementById('logoInput').files[0];
            if (!file) return;

            if (file.type !== 'image/png') {
                alert('Please upload a PNG image.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('logoPreview').src = e.target.result;
                document.getElementById('logoPreview').style.display = 'block';
                document.getElementById('previewLogo').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function generateInvoiceNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const randomNum = Math.floor(1000 + Math.random() * 9000);
            
            const invoiceNumber = `INV-${year}${month}${day}-${randomNum}`;
            document.getElementById('invoiceNumber').textContent = invoiceNumber;
            
            // Set invoice date and due date (7 days from now)
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('invoiceDate').textContent = now.toLocaleDateString('en-US', options);
            
            const dueDate = new Date(now);
            dueDate.setDate(now.getDate() + 7);
            document.getElementById('invoiceDueDate').textContent = dueDate.toLocaleDateString('en-US', options);
        }

        // Inventory Management Functions
        function showInventoryForm() {
            currentInventoryItemId = null;
            document.getElementById('inventoryFormTitle').textContent = 'Add New Product';
            document.getElementById('productName').value = '';
            document.getElementById('productSku').value = '';
            document.getElementById('productQuantity').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('inventoryFormContainer').style.display = 'block';
            
            // Scroll to form
            document.getElementById('inventoryFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function hideInventoryForm() {
            document.getElementById('inventoryFormContainer').style.display = 'none';
        }

        function saveInventoryItem() {
            const name = document.getElementById('productName').value.trim();
            const sku = document.getElementById('productSku').value.trim();
            const quantity = parseInt(document.getElementById('productQuantity').value) || 0;
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            
            if (!name) {
                alert('Please enter a product name.');
                return;
            }
            
            if (currentInventoryItemId) {
                // Update existing item
                const index = inventory.findIndex(item => item.id === currentInventoryItemId);
                if (index !== -1) {
                    inventory[index] = {
                        id: currentInventoryItemId,
                        name,
                        sku,
                        quantity,
                        price
                    };
                    
                    // Add to recent activity
                    addActivity(`Updated product: ${name}`);
                }
            } else {
                // Add new item
                const newItem = {
                    id: Date.now().toString(),
                    name,
                    sku,
                    quantity,
                    price
                };
                inventory.push(newItem);
                
                // Add to recent activity
                addActivity(`Added new product: ${name}`);
            }
            
            // Save to localStorage
            localStorage.setItem('inventory', JSON.stringify(inventory));
            
            // Update UI
            renderInventoryTable();
            hideInventoryForm();
            updateDashboardStats();
        }

        function editInventoryItem(id) {
            const item = inventory.find(item => item.id === id);
            if (!item) return;
            
            currentInventoryItemId = id;
            document.getElementById('inventoryFormTitle').textContent = 'Edit Product';
            document.getElementById('productName').value = item.name;
            document.getElementById('productSku').value = item.sku;
            document.getElementById('productQuantity').value = item.quantity;
            document.getElementById('productPrice').value = item.price;
            document.getElementById('inventoryFormContainer').style.display = 'block';
            
            // Scroll to form
            document.getElementById('inventoryFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteInventoryItem(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                const index = inventory.findIndex(item => item.id === id);
                if (index !== -1) {
                    const itemName = inventory[index].name;
                    inventory.splice(index, 1);
                    
                    // Save to localStorage
                    localStorage.setItem('inventory', JSON.stringify(inventory));
                    
                    // Update UI
                    renderInventoryTable();
                    updateDashboardStats();
                    
                    // Add to recent activity
                    addActivity(`Deleted product: ${itemName}`);
                }
            }
        }

        function renderInventoryTable() {
            const tbody = document.getElementById('inventoryItems');
            tbody.innerHTML = '';
            
            if (inventory.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="7" style="text-align: center;">No products found. Add your first product!</td>';
                tbody.appendChild(tr);
                return;
            }
            
            inventory.forEach(item => {
                const totalValue = item.quantity * item.price;
                let status = '';
                let statusClass = '';
                
                if (item.quantity === 0) {
                    status = 'Out of Stock';
                    statusClass = 'out-of-stock';
                } else if (item.quantity < 10) {
                    status = 'Low Stock';
                    statusClass = 'low-stock';
                } else {
                    status = 'In Stock';
                    statusClass = 'in-stock';
                }
                
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', item.id);
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.sku || '-'}</td>
                    <td>${item.quantity}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${formatCurrency(totalValue)}</td>
                    <td><span class="status ${statusClass}">${status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-warning btn-sm edit-item"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-item"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function exportInventoryToCSV() {
            if (inventory.length === 0) {
                alert('No inventory items to export.');
                return;
            }
            
            // CSV header
            let csv = 'Product Name,SKU,Quantity,Unit Price,Total Value,Status\n';
            
            // Add rows
            inventory.forEach(item => {
                const totalValue = item.quantity * item.price;
                let status = '';
                
                if (item.quantity === 0) {
                    status = 'Out of Stock';
                } else if (item.quantity < 10) {
                    status = 'Low Stock';
                } else {
                    status = 'In Stock';
                }
                
                csv += `"${item.name}","${item.sku || ''}",${item.quantity},${item.price},${totalValue},"${status}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `inventory_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Add to recent activity
            addActivity('Exported inventory to CSV');
        }

        // Payables Management Functions
        function showPayableForm() {
            currentPayableId = null;
            document.getElementById('payableFormTitle').textContent = 'Add New Payable';
            document.getElementById('payableVendor').value = '';
            document.getElementById('payableDescription').value = '';
            document.getElementById('payableAmount').value = '';
            
            // Set default due date to 7 days from now
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 7);
            document.getElementById('payableDueDate').value = dueDate.toISOString().split('T')[0];
            
            document.getElementById('payableStatus').value = 'pending';
            document.getElementById('payableFormContainer').style.display = 'block';
            
            // Scroll to form
            document.getElementById('payableFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function hidePayableForm() {
            document.getElementById('payableFormContainer').style.display = 'none';
        }

        function savePayable() {
            const vendor = document.getElementById('payableVendor').value.trim();
            const description = document.getElementById('payableDescription').value.trim();
            const amount = parseFloat(document.getElementById('payableAmount').value) || 0;
            const dueDate = document.getElementById('payableDueDate').value;
            const status = document.getElementById('payableStatus').value;
            
            if (!vendor) {
                alert('Please enter a vendor name.');
                return;
            }
            
            if (!dueDate) {
                alert('Please select a due date.');
                return;
            }
            
            if (currentPayableId) {
                // Update existing payable
                const index = payables.findIndex(item => item.id === currentPayableId);
                if (index !== -1) {
                    payables[index] = {
                        id: currentPayableId,
                        vendor,
                        description,
                        amount,
                        dueDate,
                        status,
                        dateCreated: payables[index].dateCreated
                    };
                    
                    // Add to recent activity
                    addActivity(`Updated payable to ${vendor}`);
                }
            } else {
                // Add new payable
                const newPayable = {
                    id: Date.now().toString(),
                    vendor,
                    description,
                    amount,
                    dueDate,
                    status,
                    dateCreated: new Date().toISOString()
                };
                payables.push(newPayable);
                
                // Add to recent activity
                addActivity(`Added new payable to ${vendor}`);
            }
            
            // Save to localStorage
            localStorage.setItem('payables', JSON.stringify(payables));
            
            // Update UI
            renderPayablesTable();
            hidePayableForm();
            updateDashboardStats();
        }

        function editPayable(id) {
            const payable = payables.find(item => item.id === id);
            if (!payable) return;
            
            currentPayableId = id;
            document.getElementById('payableFormTitle').textContent = 'Edit Payable';
            document.getElementById('payableVendor').value = payable.vendor;
            document.getElementById('payableDescription').value = payable.description;
            document.getElementById('payableAmount').value = payable.amount;
            document.getElementById('payableDueDate').value = payable.dueDate;
            document.getElementById('payableStatus').value = payable.status;
            document.getElementById('payableFormContainer').style.display = 'block';
            
            // Scroll to form
            document.getElementById('payableFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function deletePayable(id) {
            if (confirm('Are you sure you want to delete this payable?')) {
                const index = payables.findIndex(item => item.id === id);
                if (index !== -1) {
                    const vendorName = payables[index].vendor;
                    payables.splice(index, 1);
                    
                    // Save to localStorage
                    localStorage.setItem('payables', JSON.stringify(payables));
                    
                    // Update UI
                    renderPayablesTable();
                    updateDashboardStats();
                    
                    // Add to recent activity
                    addActivity(`Deleted payable to ${vendorName}`);
                }
            }
        }

        function renderPayablesTable() {
            const tbody = document.getElementById('payablesItems');
            tbody.innerHTML = '';
            
            if (payables.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="6" style="text-align: center;">No payables found. Add your first payable!</td>';
                tbody.appendChild(tr);
                return;
            }
            
            // Sort by due date (ascending)
            payables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            payables.forEach(payable => {
                const dueDate = new Date(payable.dueDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // Update status to overdue if due date has passed and status is pending
                if (dueDate < today && payable.status === 'pending') {
                    payable.status = 'overdue';
                }
                
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', payable.id);
                tr.innerHTML = `
                    <td>${payable.vendor}</td>
                    <td>${payable.description || '-'}</td>
                    <td>${formatCurrency(payable.amount)}</td>
                    <td>${dueDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</td>
                    <td><span class="status ${payable.status}">${payable.status.charAt(0).toUpperCase() + payable.status.slice(1)}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-warning btn-sm edit-payable"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-payable"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Save updated payables (in case status changed to overdue)
            localStorage.setItem('payables', JSON.stringify(payables));
        }

        // Dashboard Functions
        function updateDashboardStats() {
            // Total stock value
            const totalStockValue = inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            document.getElementById('totalStockValue').textContent = formatCurrency(totalStockValue);
            
            // Total payables
            const totalPayables = payables.reduce((sum, payable) => {
                if (payable.status !== 'paid') {
                    return sum + payable.amount;
                }
                return sum;
            }, 0);
            document.getElementById('totalPayables').textContent = formatCurrency(totalPayables);
            
            // Low stock items
            const lowStockCount = inventory.filter(item => item.quantity > 0 && item.quantity < 10).length;
            document.getElementById('lowStockCount').textContent = lowStockCount;
            
            // Recent invoices (count saved invoice data)
            const hasInvoiceData = localStorage.getItem('invoiceData') !== null;
            document.getElementById('recentInvoices').textContent = hasInvoiceData ? '1+' : '0';
        }

        function addActivity(message) {
            const activityContainer = document.getElementById('recentActivity');
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            const activityItem = document.createElement('div');
            activityItem.className = 'fade-in';
            activityItem.style.padding = '10px';
            activityItem.style.borderBottom = '1px solid var(--light-bg)';
            activityItem.innerHTML = `<strong>${timeString}</strong> - ${message}`;
            
            // If first child is "No recent activity", replace it
            if (activityContainer.firstChild && activityContainer.firstChild.textContent === 'No recent activity') {
                activityContainer.innerHTML = '';
            }
            
            // Add new activity to top
            activityContainer.insertBefore(activityItem, activityContainer.firstChild);
            
            // Limit to 10 activities
            if (activityContainer.children.length > 10) {
                activityContainer.removeChild(activityContainer.lastChild);
            }
        }

        // Utility Functions
        function formatCurrency(amount) {
            return '$' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        function toggleTheme() {
            darkMode = !darkMode;
            applyDarkMode();
            localStorage.setItem('darkMode', darkMode.toString());
            
            // Update button text
            const themeButton = document.getElementById('toggleTheme');
            themeButton.innerHTML = darkMode 
                ? '<i class="fas fa-sun"></i> Light Mode' 
                : '<i class="fas fa-moon"></i> Dark Mode';
        }

        function applyDarkMode() {
            if (darkMode) {
                document.documentElement.style.setProperty('--primary', '#F1F5F9');
                document.documentElement.style.setProperty('--secondary', '#94A3B8');
                document.documentElement.style.setProperty('--light-bg', '#1E293B');
                document.documentElement.style.setProperty('--white', '#0F172A');
                document.body.style.backgroundColor = '#0F172A';
            } else {
                document.documentElement.style.setProperty('--primary', '#0F172A');
                document.documentElement.style.setProperty('--secondary', '#64748B');
                document.documentElement.style.setProperty('--light-bg', '#F1F5F9');
                document.documentElement.style.setProperty('--white', '#FFFFFF');
                document.body.style.backgroundColor = '#F1F5F9';
            }
        }
    </script>
</body>
</html>